@app.route('/search', methods=['POST'])
@login_required
def search():
    """Cerca un farmaco su PubChem e mostra i risultati in results.html"""
    query = request.form.get('query')

    if not query:
        flash("Inserisci un nome di farmaco valido!", "warning")
        return redirect(url_for('dashboard'))

    try:
        # Ricerca il farmaco su PubChem
        results = pcp.get_compounds(query, 'name')

        if results:
            compound = results[0]  # Prendiamo il primo risultato disponibile
            return render_template('results.html', query=query, compound=compound)
        else:
            flash("Nessun farmaco trovato!", "warning")
            return redirect(url_for('dashboard'))

    except Exception as e:
        flash("Errore nella ricerca del farmaco!", "danger")
        print(f"Errore PubChem: {e}")
        return redirect(url_for('dashboard'))
